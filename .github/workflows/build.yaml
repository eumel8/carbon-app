# https://github.com/marketplace/actions/go-release-binaries
name: build app
on:
  push:
    branches:
      - main
    tags:        
      - '*'
  release:
    types: [created]

jobs:
  release-linux-amd64:
    name: release linux/amd64
    runs-on: ubuntu-latest
    strategy:
      matrix:
        goos: [linux]
        #goos: [linux, windows, darwin]
        goarch: [amd64]
        #goarch: [amd64, arm64]
        exclude:
          - goarch: arm64
            goos: windows
    steps:
    - uses: actions/checkout@v2
    - uses: actions/setup-go@v3
    - name: install packages
      run: |
          go version
          sudo apt update
          sudo apt-get -y install bc gcc libgl1-mesa-dev libwayland-dev libx11-dev libxkbcommon-dev xorg-dev xvfb
          go install github.com/fyne-io/fyne-cross@latest
          export PATH=$PATH:~/go/bin
          echo "$HOME/go/bin" >> $GITHUB_PATH
          fyne-cross linux -output carbon-app -arch=amd64 -debug .
          #sudo apt update
          #sudo apt-get -y install bc gcc libgl1-mesa-dev libwayland-dev libx11-dev libxkbcommon-dev xorg-dev xvfb
          #sudo apt-get -y install libxcursor-dev libxrandr-dev libxinerama-dev libxi-dev gcc pkg-config libxxf86vm-dev
    #- name: Upload artifacts
    #  uses: actions/upload-artifact@v4
    #  with:
    #    name: linux-amd64
    #    path: fyne-cross/dist/linux-amd64/
    - name: Release
      uses: fnkr/github-action-ghr@v1
      if: startsWith(github.ref, 'refs/tags/')
      env:
        GHR_PATH: fyne-cross/dist/linux-amd64/
    #- uses: wangyoucao577/go-release-action@v1.51
    #  with:
    #    github_token: ${{ secrets.GITHUB_TOKEN }}
    #    goos: ${{ matrix.goos }}
    #    goarch: ${{ matrix.goarch }}
    #    binary_name: carbon-app
    #    retry: 10
    #    sha256sum: true
    #    pre_command: go mod tidy
